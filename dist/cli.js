#!/usr/bin/env node
"use strict";var y=Object.create;var n=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var w=Object.getOwnPropertyNames;var x=Object.getPrototypeOf,O=Object.prototype.hasOwnProperty;var a=(e,s)=>n(e,"name",{value:s,configurable:!0});var E=(e,s,o,i)=>{if(s&&typeof s=="object"||typeof s=="function")for(let t of w(s))!O.call(e,t)&&t!==o&&n(e,t,{get:()=>s[t],enumerable:!(i=k(s,t))||i.enumerable});return e};var D=(e,s,o)=>(o=e!=null?y(x(e)):{},E(s||!e||!e.__esModule?n(o,"default",{value:e,enumerable:!0}):o,e));var b=D(require("yargs")),u=require("yargs/helpers");var p="1.2.0";var l=require("@povio/scaffold"),f=require("util");var r=require("colorette");var d=a((e,s,o)=>{switch(e.type){case"module-stub":case"module":{switch(s){case"configure":{console.log(`${(0,r.blue)(e.name)} [module:${s}] ${JSON.stringify(o)}`);break}case"message":{console.log(`${(0,r.blue)(e.name)} [module:${s}] ${o.type}: ${o.message}`),o.error&&console.error(o.error);break}case"register":case"status":case"init":break;default:{console.log(`${(0,r.blue)(e.name)} [module:${s}]`),o&&console.log(o);break}}break}case"request":{switch(s){case"message":{console.log(`${(0,r.blue)(e.module.name)} [request:${s}] ${o.type}: ${o.message}`),o.error&&console.error(o.error);break}case"register":case"init":break;default:{console.log(`${(0,r.blue)(e.module.name)} [request:${s}] [match:${e.match}]`),o&&console.log(o);break}}break}case"executor":{switch(s){case"register":break;default:{console.log(`${(0,r.blue)(e.module.name)} [executor:${s}] ${(0,r.magenta)(e.match)}`),o&&console.log(o);break}}break}case"task":{switch(s){case"init":break;case"message":{console.log(`${(0,r.blue)(e.request.module.name)} [task:${s}] ${(0,r.magenta)(e.executor.match)} ${o.type}: ${o.message}`),o.error&&console.error(o.error);break}default:{console.log(`${(0,r.blue)(e.request.module.name)} [task:${s}] ${(0,r.magenta)(e.executor.match)}`),o&&console.log(o);break}}break}case"handler":{switch(s){case"prepared":{console.log(`${(0,r.cyan)("handler")} [handler:${s}] ${o??""}`),Object.values(e.modulesDict).forEach(i=>{let t=i.status==="completed"?r.dim:r.bold;console.log(`${(0,r.blue)(i.name)} ${t(`[status:${i.status}] ${i.description??""}`)}`),Object.values(i.tasks).forEach(c=>{console.log(`${(0,r.blue)(i.name)} [task:${c.executor.match}] [status:${c.status}] ${c.request.description??""}`)})});break}default:break}break}default:console.error(e,s,o)}},"scaffoldingLogger");var g={command:"apply",describe:"apply scaffolding",builder:{cwd:{describe:"Root directory of the project",demandOption:!0,type:"string",default:process.cwd()},verbose:{describe:"Verbose output",type:"boolean",default:!1}},handler:async e=>{try{let s=e.cwd,i=e.verbose?(c,$,h)=>console.log($,(0,f.inspect)(c,{showHidden:!1,depth:2,colors:!0}),h):d,t=new l.ScaffoldingHandler(s,i);for await(let c of(0,l.findScaffoldFiles)({cwd:s}))t.register(c);await t.init(),t.status!=="error"?await t.exec():console.error("Error during init")}catch(s){console.error(s),process.exit(1)}}};(0,b.default)((0,u.hideBin)(process.argv)).version(p).scriptName("scaffold").command(g).help().demandCommand(1).strictCommands(!0).showHelpOnFail(!0).fail((e,s)=>{e&&console.log(e),s&&console.error(s),console.log("Use '--help' for more info"),process.exit(1)}).parse();
